<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>動畫紀錄</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div data-include="header.html"></div>
  <main>
    <section id="animeList"></section>
  </main>

  <footer>
    <small>© 動畫進度</small>
  </footer>

  <script type="module">
    import { loadLocal, badgeHTML } from './app.js';
    const container = document.getElementById('animeList');
    const db = loadLocal();
    if (!db.items.length) {
      container.innerHTML = '<p>尚未登記任何動畫。</p>';
    } else {
      container.innerHTML = db.items.map(a => `
        <div class="anime-item">
          <img src="${a.image}" alt="${a.name}">
          <h3>${a.name}</h3>
          ${badgeHTML(a)}
        </div>
      `).join('');
    }
  </script>
<script>
  // 自動載入共用 header（含 cache-busting）
  (function loadSharedPart(){
    const ts = (window.__BUILD_TS || Date.now()); // 版本號/時間戳
    document.querySelectorAll('[data-include]').forEach(el=>{
      const file = el.getAttribute('data-include');
      const url = file + '?v=' + ts;
      fetch(url).then(r=>r.text()).then(html=>{
        el.innerHTML = html;
        // 載入完成後（header 已插入 DOM），呼叫全域初始化（若有）
        if (window.setupHeader) window.setupHeader();
      }).catch(err=>{
        console.error('無法載入共用檔案：', file, err);
      });
    });
  })();
</script>
</body>
</html>
